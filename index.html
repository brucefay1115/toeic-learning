<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TOEIC AI Tutor</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#5856D6">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./assets/icons/icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/styles.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

    <header>
        <h1>TOEIC AI Tutor</h1>
        <div class="header-right">
            <div class="sync-indicator" id="syncIndicator" title="Cloud Sync">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/></svg>
                <span class="sync-tooltip" id="syncTooltip"></span>
            </div>
            <button class="settings-btn" id="btnSettings"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 21v-7M4 10V3M12 21v-9M12 8V3M20 21v-5M20 12V3M1 14h6M9 8h6M17 16h6"/></svg></button>
        </div>
    </header>

    <!-- TAB: Learn -->
    <div id="tabLearn" class="container">
        <div id="emptyState" class="empty-state">
            <div class="empty-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg></div>
            <p>還沒有學習內容</p>
            <p>開始生成第一篇練習文章吧！</p>
            <button class="cta-btn">開始練習</button>
        </div>
        <div id="learningArea" class="hidden">
            <div class="article-card">
                <div class="article-meta" id="articleMeta"></div>
                <div id="articleContainer"></div>
                <div class="toggle-btn-row">
                    <button class="translate-toggle-btn" id="btnToggleEn">隱藏英文</button>
                    <button class="translate-toggle-btn" id="btnToggleZh">顯示中文</button>
                </div>
            </div>
            <h3 class="section-title">核心單字 Vocabulary</h3>
            <div class="vocab-grid" id="vocabList"></div>
            <h3 class="section-title" id="phraseSectionTitle">常用片語 Key Phrases</h3>
            <div id="phraseList"></div>
        </div>
    </div>

    <!-- TAB: Practice -->
    <div id="tabPractice" class="container hidden">
        <div class="practice-container">
            <h2>選擇目標分數</h2>
            <p class="subtitle">根據你的多益程度選擇適合的難度</p>
            <div class="score-selector" id="scoreSelector"></div>
            <div class="practice-section">
                <h3 class="practice-label">自訂主題（選填）</h3>
                <input type="text" class="topic-input" id="customTopic" placeholder="例如：機場報到、商業會議、餐廳點餐...">
            </div>
            <div class="practice-section">
                <h3 class="practice-label">朗讀語音</h3>
                <div class="voice-selector" id="voiceSelector"></div>
            </div>
            <button class="generate-btn" id="btnGenerate">開始學習 (Generate)</button>
        </div>
    </div>

    <!-- TAB: Vocab -->
    <div id="tabVocab" class="container hidden">
        <div class="vocab-tab-header">
            <h3 class="section-title">單字本 Vocabulary</h3>
            <span class="vocab-tab-count" id="vocabCount">0 個單字</span>
        </div>
        <div id="srsReviewEntry"></div>
        <div id="savedWordsList"></div>
    </div>

    <!-- TAB: History -->
    <div id="tabHistory" class="container hidden">
        <h3 class="section-title" style="margin-top: 10px;">學習紀錄 History</h3>
        <div id="historyList"></div>
        <button id="btnClearHistory" style="font-size:12px; color:red; background:none; border:none; margin-top:10px;">清除全部紀錄</button>
    </div>

    <nav class="tab-bar">
        <button class="tab-btn active" data-tab="learn">
            <span class="tab-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg></span>
            <span class="tab-label">學習</span>
        </button>
        <button class="tab-btn" data-tab="practice">
            <span class="tab-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg></span>
            <span class="tab-label">練習</span>
        </button>
        <button class="tab-btn" data-tab="vocab">
            <span class="tab-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg></span>
            <span class="tab-label">單字本</span>
        </button>
        <button class="tab-btn" data-tab="history">
            <span class="tab-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span>
            <span class="tab-label">紀錄</span>
        </button>
    </nav>

    <div class="player-bar hidden" id="playerBar">
        <button class="play-btn" id="btnPlayPause"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="6 3 20 12 6 21 6 3"/></svg></button>
        <div class="progress-container" id="progressContainer"><div class="progress-fill" id="progressBar"></div></div>
        <button class="speed-btn" id="btnSpeed">1.0x</button>
    </div>

    <div class="word-modal" id="wordModal">
        <div class="wm-header">
            <div class="wm-word" id="wmWord">Word</div>
            <button class="large-speaker" id="btnWordAudio"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg></button>
        </div>
        <div class="wm-meta"><span id="wmPos">n.</span> <span id="wmIpa">/IPA/</span></div>
        <div class="wm-def" id="wmDef">Definition</div>
        <div style="font-style: italic; color: #666; margin-bottom: 6px; display: flex; align-items: center;" id="wmEx">
            <span id="wmExText">Example.</span>
            <button class="mini-speaker" id="wmExSpeakBtn" style="margin-left:5px;"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg></button>
        </div>
        <div style="font-size: 14px; color: var(--text-sub); margin-bottom: 20px;" id="wmExZh" class="hidden"></div>
        <div id="wmActionArea" class="wm-actions"></div>
        <button class="wm-btn secondary">關閉</button>
    </div>

    <div class="modal-overlay" id="keyModal">
        <div class="modal-card">
            <h3>設定 Gemini API</h3>
            <a href="https://aistudio.google.com/app/apikey" target="_blank" class="api-guide-link">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.78 7.78 5.5 5.5 0 0 1 7.78-7.78Zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
                <span>點此取得 Google API Key<br><span style="font-size:11px; font-weight:400;">(需登入 Google 帳號)</span></span>
            </a>
            <div class="input-group"><input type="password" id="apiKeyInput" placeholder="Paste API Key here..."></div>
            <button class="generate-btn" id="btnSaveApiKey" style="margin: 10px 0 0;">儲存</button>
            <button class="wm-btn secondary" id="btnCloseKeyModal" style="margin-top: 8px; display: none;">關閉</button>
            <p style="font-size: 11px; color: #999; margin-top: 10px;">Key 僅儲存於本地裝置 (IndexedDB)</p>

            <div class="cloud-section">
                <h4>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/></svg>
                    雲端備份 Cloud Backup
                </h4>
                <div id="cloudAuthArea">
                    <button class="cloud-login-btn" id="btnCloudLogin">
                        <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
                        使用 Google 帳號登入
                    </button>
                </div>
                <div id="cloudUserArea" class="hidden">
                    <div class="cloud-user-info">
                        <div class="cloud-user-avatar" id="cloudAvatar">G</div>
                        <div class="cloud-user-detail">
                            <div class="cloud-user-name" id="cloudUserName">User</div>
                            <div class="cloud-user-email" id="cloudUserEmail">user@gmail.com</div>
                        </div>
                    </div>
                    <div class="cloud-actions">
                        <button class="cloud-action-btn primary" id="btnBackupNow">立即備份</button>
                        <button class="cloud-action-btn" id="btnRestore">從雲端還原</button>
                        <button class="cloud-action-btn danger" id="btnCloudLogout">登出</button>
                    </div>
                    <div class="cloud-last-sync" id="cloudLastSync"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="srs-overlay hidden" id="srsOverlay">
        <div class="srs-content">
            <div class="srs-top-bar">
                <button class="srs-close-btn"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
                <span class="srs-progress-text" id="srsProgressText">1 / 9</span>
                <span class="srs-phase-badge" id="srsPhaseBadge">英文 → 中文</span>
            </div>
            <div class="srs-question-area" id="srsQuestionArea"></div>
            <div class="srs-options-area" id="srsOptionsArea"></div>
        </div>
    </div>

    <audio id="mainAudio"></audio>

<script type="module" src="./assets/js/main.js"></script>
</body>
</html>
